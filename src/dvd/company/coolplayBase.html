<!DOCTYPE html>
<html lang="en">
<head>
    <base href="http://webapi.amap.com/ui/1.0/ui/misc/PoiPicker/examples/" />
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>基地列表</title>

    <style type="text/css">

        #basePosMap {
            width: 100%;
            height: 100%;
            margin: 0px;
            font-size: 13px;
        }

        #pickerBox {
            position: absolute;
            z-index: 9999;
            top: 50px;
            right: 30px;
            width: 300px;
        }

        #pickerInput {
            width: 200px;
            padding: 5px 5px;
        }

        #poiInfo {
            background: #fff;
        }

        .amap_lib_placeSearch .poibox.highlight {
            background-color: #CAE1FF;
        }

        .amap_lib_placeSearch .poi-more {
            display: none!important;
        }

    </style>
</head>

<body>

<div class="super-theme-example">
    <div class="search-form-item col-md-4">
        <label class="label-top">基地名称：</label>
        <input name="baseName" class="easyui-validatebox easyui-textbox" prompt="请输入基地名称">
    </div>

    <div class="search-form-item col-md-4">
        <label class="label-top">基地状态：</label>

        <select class="easyui-combobox" data-options="editable:false,panelHeight:null" name="isClose">
            <option value="" selected>全部</option>
            <option value="0">正常</option>
            <option value="1">关闭</option>
        </select>
    </div>

    <div class="search-form-item col-md-3">
        <a href="javascript:void(0)" onclick="refreshCoolplayBase()" class="easyui-linkbutton primary">查询</a>
        <a href="javascript:void(0)" onclick="addCoolplayBase()" class="easyui-linkbutton primary">创建基地</a>
    </div>
</div>

<div class="clear"></div>

<div class="super-theme-example">
    <div style="height: 340px;">
        <table id="coolplayBaseTab"></table>
    </div>

    <div id="coolplayBaseWin" style="display: none;padding-top:30px;" title="创建基地">
        <form id="coolplayBaseForm" method="post">
            <div class="form-item col-md-12">
                <label class="label-top">基地全称：</label>

                <input class="easyui-validatebox easyui-textbox" prompt="请输入基地全称" id="coolplayBase_baseFullName" name="baseFullName" data-options="required:true, missingMessage:'请输入基地全称'" style="width: 80%;">
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">基地简称：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入基地简称" id="coolplayBase_baseName" name="baseName" data-options="required:true, missingMessage:'请输入基地简称'" style="width: 80%;">
            </div>

            <div class="form-item col-md-12" style="height:300px;">
                <label class="label-top">基地基本信息：</label>
                <!--<input class="easyui-validatebox easyui-textbox" prompt="请输入基地基本信息" name="baseDesc" data-options="required:true, missingMessage:'请输入基地基本信息'">-->
                <input type="hidden" name="baseDesc"/>
                <div class="easyui-texteditor" id="baseDescEditorDiv" title="基地基本信息" style="width:80%;height:300px;padding:20px;left:126px;top:0px;">

                </div>
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">联系人：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入联系人" id="coolplayBase_contactName" name="contactName" data-options="required:true, missingMessage:'请输入联系人'" style="width: 80%;">
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">联系电话：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入联系电话" id="coolplayBase_contactPhone" name="contactPhone" data-options="required:true, missingMessage:'请输入联系电话', validType:'telephone'" style="width: 80%;">
            </div>

            <div class="form-item col-md-12" style="height:320px;">
                <label class="label-top" style="float:left;">地图标点：</label>

                <div id="basePosMap" class="map" tabindex="0" style="width: 80%; height: 100%; margin-left: 15px; font-size: 13px;"></div>
                <div id="pickerBox" style="position: absolute; z-index: 9999999; top: 30px; left: 150px; width: 300px;">
                    <input id="pickerInput" style="width: 200px; padding: 5px 5px;" placeholder="输入关键字选取地点" />
                    <div id="poiInfo" style="background: #fff;"></div>
                </div>

                <input type="hidden" name="posX" />
                <input type="hidden" name="posY" />
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">GPS坐标：</label>
                <input class="easyui-validatebox easyui-textbox" id="coolplayBase_gps" prompt="请输入GPS坐标" name="gps" data-options="required:true, missingMessage:'请输入GPS坐标', validType:'isGps'" style="width: 80%;">
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">基地地址：</label>
                <input class="easyui-validatebox easyui-textbox" id="coolplayBase_contactAddress" prompt="请输入基地地址" name="contactAddress" data-options="required:true, missingMessage:'请输入基地地址'" style="width: 80%;">
            </div>

            <div class="form-item col-md-12">
                <label class="label-top" style="float:left;">背景图片：</label>

                <!--<input class="easyui-validatebox easyui-textbox" id="coolplayBase_backgroudImg" prompt="请输入背景图片" name="backgroudImg" data-options="required:true, missingMessage:'请输入基地地址'" style="width: 80%;">-->

                <div id="backgroudImgDiv" style="float:left;">

                </div>
            </div>

            <div class="form-item col-md-12">
                <hr />
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">起飞场GPS：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入起飞场GPS" id="coolplayBase_departuresGps" name="departuresGps" data-options="required:true, missingMessage:'请输入起飞场GPS', validType:'isGps'" style="width: 80%;">

                <a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="openGPSWin('coolplayBase_departuresGps')">定位</a>
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">起飞场海拔高度：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入起飞场海拔高度" id="coolplayBase_departuresHeight" name="departuresHeight" data-options="required:true, missingMessage:'请输入起飞场海拔高度', validType:'isNumber'" style="width: 80%;">
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">降落场GPS：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入降落场GPS" id="coolplayBase_landGps" name="landGps" data-options="required:true, missingMessage:'请输入降落场GPS', validType:'isGps'" style="width: 80%;">

                <a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="openGPSWin('coolplayBase_landGps')">定位</a>
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">降落场海拔高度：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入降落场海拔高度" id="coolplayBase_landHeight" name="landHeight" data-options="required:true, missingMessage:'请输入降落场海拔高度', validType:'isNumber'" style="width: 80%;">
            </div>

            <div class="form-item col-md-12">
                <label class="label-top" style="float:left;">可飞风向：</label>
                <!--<input class="easyui-validatebox easyui-textbox" prompt="请输入可飞风向" name="flyDirection" data-options="required:true, missingMessage:'请输入可飞风向'">
-->
                <div class="wind_direction" style="margin-left:300px;">
                    <div class="wind_direction_text" style="position:absolute; bottom: 3in; left: 3.3in; right: 1in; top: 1.45in;" data="西风">西风</div>
                    <div class="wind_direction_text" style="position:absolute; bottom: 3in; left: 3.3in; right: 1in; top: 0.3in;" data="西北风">西北风</div>
                    <div class="wind_direction_text" style="position:absolute; bottom: 3in; left: 4.7in; right: 1in; top: 0in;" data="北风">北风</div>
                    <div class="wind_direction_text" style="position:absolute; bottom: 3in; left: 6.1in; right: 1in; top: 0.3in;" data="东北风">东北风</div>
                    <div class="wind_direction_text" style="position:absolute; bottom: 3in; left: 6.1in; right: 1in; top: 1.45in;" data="东风">东风</div>
                    <div class="wind_direction_text" style="position:absolute; bottom: 3in; left: 6.1in; right: 1in; top: 2.6in;" data="东南风">东南风</div>
                    <div class="wind_direction_text" style="position:absolute; bottom: 3in; left: 4.7in; right: 1in; top: 2.9in;" data="南风">南风</div>
                    <div class="wind_direction_text" style="position:absolute; bottom: 3in; left: 3.3in; right: 1in; top: 2.6in;" data="西南风">西南风</div>
                </div>

                <!--<div style="margin-left:20px;float:left;">
                    <input class="easyui-checkbox" name="flyDirection" value="东" label="东:" />
                </div>
                <div style="margin-left:20px;float:left;">
                    <input class="easyui-checkbox" name="flyDirection" value="南" label="南:" />
                </div>
                <div style="margin-left:20px;float:left;">
                    <input class="easyui-checkbox" name="flyDirection" value="西" label="西:" />
                </div>
                <div style="margin-left:20px;float:left;">
                    <input class="easyui-checkbox" name="flyDirection" value="北" label="北:" />
                </div>
                <div style="margin-left:20px;float:left;">
                    <input class="easyui-checkbox" name="flyDirection" value="东南" label="东南:" />
                </div>
                <div style="margin-left:20px;float:left;">
                    <input class="easyui-checkbox" name="flyDirection" value="东北" label="东北:" />
                </div>
                <div style="margin-left:20px;float:left;">
                    <input class="easyui-checkbox" name="flyDirection" value="西南" label="西南:" />
                </div>
                <div style="margin-left:20px;float:left;">
                    <input class="easyui-checkbox" name="flyDirection" value="西北" label="西北:" />
                </div>-->

                <input type="hidden" name="flyDirection"/>
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">监控视频url：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入监控视频url" id="coolplayBase_monitorVideoUrl" name="monitorVideoUrl" data-options="required:true, missingMessage:'请输入监控视频url'" style="width: 80%;">
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">基地类型：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入基地类型" id="coolplayBase_baseType" name="baseType" data-options="required:true, missingMessage:'请输入基地类型'" style="width: 80%;">
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">标签：</label>

                <label class="label-top labelIdsDiv">

                </label>
            </div>

            <!--<div class="form-item col-md-12">
                <label class="label-top">开放时间：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入开放时间" name="openTime" data-options="required:true, missingMessage:'请输入开放时间'">
            </div>

            <div class="form-item col-md-12">
                <label class="label-top">容纳人数：</label>
                <input class="easyui-validatebox easyui-textbox" prompt="请输入容纳人数" name="capacityCnt" data-options="required:true, missingMessage:'请输入容纳人数', validType:'isNumber'">
            </div>-->

            <div class="form-item col-md-12">
                <label class="label-top">状态：</label>

                <select class="easyui-combobox" data-options="editable:false,panelHeight:null" id="coolplayBase_isClose" name="isClose">
                    <option value="0" selected>正常</option>
                    <option value="1">关闭</option>
                </select>
            </div>

            <div class="form-item col-md-12">
                <a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="saveCoolplayBaseWin()">确认新增</a>
                <a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="closeCoolplayBaseWin()">取消</a>
            </div>
        </form>
    </div>

    <div id="coolplayBaseDetailWin" style="display: none;padding-top:30px;" title="基地详情">
        <div class="form-item col-md-12">
            <label class="label-top">基地全称：</label>

            <label class="label-top baseFullNameLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">基地简称：</label>

            <label class="label-top baseNameLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">基地基本信息：</label>

            <label class="label-top baseDescLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">联系人：</label>

            <label class="label-top contactNameLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">联系电话：</label>

            <label class="label-top contactPhoneLabel"></label>
        </div>

        <div class="form-item col-md-12" style="height:300px;">
            <label class="label-top" style="float:left;">地图标点：</label>

            <!--<label class="label-top Label"></label>-->
            <div id="basePosDetailMap" style="width:80%;height:100%;float:left;"></div>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">基地地址：</label>

            <label class="label-top contactAddressLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">背景图片：</label>

            <span>
                <img id="detailBackgroudImg" style="width:500px;height:150px;"/>
            </span>
        </div>

        <div class="form-item col-md-12">
            <hr />
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">起飞场GPS：</label>

            <label class="label-top departuresGpsLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">起飞场海拔高度：</label>

            <label class="label-top departuresHeightLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">降落场GPS：</label>

            <label class="label-top landGpsLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">降落场海拔高度：</label>

            <label class="label-top landHeightLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">可飞风向：</label>

            <label class="label-top flyDirectionLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">监控视频url：</label>

            <label class="label-top monitorVideoUrlLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">基地类型：</label>

            <label class="label-top baseTypeLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">标签：</label>

            <label class="label-top labelIdsLabel"></label>
        </div>

        <!--<div class="form-item col-md-12">
            <label class="label-top">开放时间：</label>

            <label class="label-top openTimeLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <label class="label-top">容纳人数：</label>

            <label class="label-top capacityCntLabel"></label>
        </div>-->

        <div class="form-item col-md-12">
            <label class="label-top">状态：</label>

            <label class="label-top isCloseLabel"></label>
        </div>

        <div class="form-item col-md-12">
            <a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="closeCoolplayBaseDetailWin()">关闭</a>
        </div>
    </div>

    <div id="GPSWin" style="display: none;padding-top:30px;" title="GPS定位">
        <div id="GPSMap" class="map" tabindex="0" style="width: 100%; height: 90%; font-size: 13px;"></div>
        <div id="GPSPickerBox" style="position: absolute; z-index: 9999999; top: 70px; left: 30px; width: 300px;">
            <input id="GPSPickerInput" style="width: 200px; padding: 5px 5px;" placeholder="输入关键字选取地点" />
            <div id="GPSPoiInfo" style="background: #fff;"></div>
        </div>

        <div class="form-item col-md-12">
            <a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="closeGPSWin()">关闭</a>
        </div>
    </div>
</div>

<script type="text/javascript">
    ;(function ($, window, document, undefined){

        $('#coolplayBaseTab').datagrid({
            url: App.href + '/api/company/coolplayBase/list',
            fit: true,
            pagination: true,
            fitColumns: true,
            method: 'GET',
            pageSize: 10,
            pageList: [10, 25, 50, 100, 200],
            height: 340,
            queryParams: {},
            toolbar: [],
            loadFilter: function(data) {
                if (data.code === 401) {
                    App.showMsg('token失效,请登录!');
                    window.location.href = App.href + '/login.html';
                    return {"total":0, "rows": "[]"};
                } else {
                    return data;
                }
            },
            onBeforeLoad: function (param) {
                var baseName = $("input[name=baseName]").val();
                var isClose = $("input[name=isClose]").val();

                param.baseName = baseName;
                param.isClose = isClose;
            },
            columns: [
                [{
                    field: 'id',
                    title: '编号',
                    sortable: true,
                    width: 50
                }, {
                    field: 'contactName',
                    title: '联系人',
                    width: 50
                }, {
                    field: 'baseName',
                    title: '基地名称',
                    width: 50
                },  {
                    field: 'contactAddress',
                    title: '基地地址',
                    width: 50
                },  {
                    field: 'contactPhone',
                    title: '电话',
                    width: 50
                }/*,  {
                    field: 'capacityCnt',
                    title: '容纳人数',
                    width: 50
                }*/,  {
                    field: 'ctime',
                    title: '创建时间',
                    width: 100
                },  {
                    field: 'companyUserName',
                    title: '创建人',
                    width: 50
                },  {
                    field: 'isClose',
                    title: '状态',
                    width: 50,
                    formatter: function(value, row, index) {
                        var isCloseStr = "开放";
                        if(row.isClose == 1) {
                            isCloseStr = "关闭";
                        }

                        return isCloseStr;
                    }
                },  {
                    field: 'custom_col1',
                    title: '操作',
                    width: 50,
                    align: 'center',
                    formatter: function(value, row, index) {
                        var btns = new Array();
                        btns.push('<a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="showCoolplayBase('+ row.id +')">详情</a>&nbsp;');
                        btns.push('<a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="delCoolplayBase('+ row.id +')">删除</a>&nbsp;');
                        if(row.isClose == 1) {
                            btns.push('<a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="closeCoolplayBase('+ row.id +', 0)">开放</a>');
                        } else if(row.isClose == 0) {
                            btns.push('<a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="closeCoolplayBase('+ row.id +', 1)">关闭</a>');
                        }
                        return btns.join('');
                    }
                }]
            ]
        });

        $('#coolplayBaseForm').form({
            url: App.href + '/api/company/coolplayBase/saveCoolplayBase',
            method: 'POST',
            onSubmit:function(){
                return $(this).form('validate');
            },
            success:function(data){
                var obj = JSON.parse(data);
                if (obj.code == 200) {
                    App.showMsg('保存成功');
                    $('#coolplayBaseWin').window('close');
                } else {
                    App.showMsg(obj.message);
                }
                $('#coolplayBaseTab').datagrid('reload');
            }
        });

        App.getRequestData('/api/company/label/options', {}, function(data) {
            var html = [];
            if(data.length > 0) {
                for(var i=0; i<data.length; i++) {
                    html.push('<label for="labelIds'+ i +'">' + data[i].text + '：</label>');
                    html.push('<input type="checkbox" id="labelIds'+ i +'" name="labelIds" value="'+ data[i].value +'" style="width: 50px;">');
                }
            }
            $(".labelIdsDiv").append(html.join(''));
        });

        var markers = [];

        //渲染基地地图
        var map = new AMap.Map('basePosMap', {
            zoom: 10
        });

        window.map = map;
        window.markers = markers;

        var geocoder = new AMap.Geocoder({
            city: "010", //城市设为北京，默认：“全国”
            radius: 1000 //范围，默认：500
        });

        AMapUI.loadUI(['control/BasicControl'], function(BasicControl) {

            //缩放控件，显示Zoom值
            map.addControl(new BasicControl.Zoom({
                position: 'lb',
                showZoomNum: true
            }));

            //图层切换控件
            map.addControl(new BasicControl.LayerSwitcher({
                position: 'rt'
            }));
        });

        AMapUI.loadUI(['misc/PoiPicker'], function(PoiPicker) {

            var poiPicker = new PoiPicker({
                //city:'北京',
                input: 'pickerInput'
            });

            //初始化poiPicker
            poiPickerReady(poiPicker);
        });

        map.on('click', function(e){
            if(markers.length > 0) {
                map.remove(markers);
            }

            var marker = new AMap.Marker({
                map:map,
                position:[e.lnglat.getLng(), e.lnglat.getLat()],
                label: {
                    offset: new AMap.Pixel(20, 20),//修改label相对于maker的位置
                }
            });

            //定位设置坐标
            $("#coolplayBaseForm").find("input[name=posX]").val(e.lnglat.getLng());
            $("#coolplayBaseForm").find("input[name=posY]").val(e.lnglat.getLat());
            $("#coolplayBase_gps").textbox('setValue', e.lnglat.getLng() + "," + e.lnglat.getLat());

            geocoder.getAddress(e.lnglat.getLng() + "," + e.lnglat.getLat(), function(status, result) {
                if (status === 'complete' && result.regeocode) {
                    var address = result.regeocode.formattedAddress;
                    $("#coolplayBase_contactAddress").textbox('setValue', address);
                }else{
                    console.log('根据经纬度查询地址失败');
                }
            });

            markers.push(marker);
        });

        function poiPickerReady(poiPicker) {

            window.poiPicker = poiPicker;

            //选取了某个POI
            poiPicker.on('poiPicked', function(poiResult) {
                poi = poiResult.item;

                var marker = new AMap.Marker();

                marker.setMap(map);

                marker.setPosition(poi.location);
                map.setCenter(marker.getPosition());

                $("#coolplayBaseForm").find("input[name=posX]").val(poi.location.lng);
                $("#coolplayBaseForm").find("input[name=posY]").val(poi.location.lat);
                $("#coolplayBase_gps").textbox('setValue', poi.location.lng + "," + poi.location.lat);

                geocoder.getAddress(poi.location.lng + "," + poi.location.lat, function(status, result) {
                    if (status === 'complete' && result.regeocode) {
                        var address = result.regeocode.formattedAddress;
                        $("#coolplayBase_contactAddress").textbox('setValue', address);
                    }else{
                        console.log('根据经纬度查询地址失败');
                    }
                });

                if(markers.length > 0) {
                    map.remove(markers);
                }

                markers.push(marker);
            });
        }

        $(".wind_direction div").click(function() {
            $(this).toggleClass("wind_direction_text").toggleClass("wind_direction_text_active");
        });

    })(jQuery, window, document);


    function refreshCoolplayBase() {
        $('#coolplayBaseTab').datagrid('reload');
    }

    /**
     * 添加公司基地
     *
     */
    function addCoolplayBase() {
        $('#coolplayBaseWin').window({
            width: "80%",
            height: "80%",
            modal:true
        });

        //调整输入框长度
        //$("#coolplayBaseForm").find('span.textbox.textbox-invalid').css('width', '80%');
        if(window.markers && window.markers.length > 0) {
            window.map.remove(window.markers);
        }

        $("#coolplayBase_baseFullName").textbox('setValue', '');
        $("#coolplayBase_baseName").textbox('setValue', '');
        $("#baseDescEditorDiv").texteditor('setValue', '');
        $("#coolplayBaseForm").find("input[name=baseDesc]").val('');
        $("#coolplayBase_gps").textbox('setValue', '');
        $("#coolplayBase_contactName").textbox('setValue', '');
        $("#coolplayBase_contactPhone").textbox('setValue', '');
        $("#coolplayBase_contactAddress").textbox('setValue', '');
        $("#coolplayBase_departuresGps").textbox('setValue', '');
        $("#coolplayBase_departuresHeight").textbox('setValue', '');
        $("#coolplayBase_landGps").textbox('setValue', '');
        $("#coolplayBase_landHeight").textbox('setValue', '');
        $("#coolplayBase_monitorVideoUrl").textbox('setValue', '');
        $("#coolplayBase_baseType").textbox('setValue', '');
        $("#coolplayBase_isClose").combobox('setValue', '0');

        $(".labelIdsDiv").find('input[type=checkbox]').prop("checked", false);
        $("#coolplayBaseForm").find("input[name=flyDirection]").val('');

        $("#coolplayBaseForm").find("input[name=posX]").val('');
        $("#coolplayBaseForm").find("input[name=posY]").val('');

        $(".wind_direction_text_active").each(function(){
            $(this).removeClass('wind_direction_text_active');
            $(this).addClass('wind_direction_text');
        });

        var backgroudImgEle = App.uploadImage({id: "backgroudImg", name: 'backgroudImg', isAjaxUpload: true, autoUpload: true});
        $('#backgroudImgDiv').html(backgroudImgEle);
    }

    /**
     * 关闭GPS窗口
     */
    function closeGPSWin() {
        $('#GPSWin').window('close');
    }

    /**
     * 地址定位窗口
     */
    function openGPSWin(elementId) {
        $('#GPSWin').window({
            width: "60%",
            height: "80%",
            left:"30%",
            modal:true
        });

        //渲染基地地图
        var map = new AMap.Map('GPSMap', {
            zoom: 10
        });

        var geocoder = new AMap.Geocoder({
            city: "010", //城市设为北京，默认：“全国”
            radius: 1000 //范围，默认：500
        });

        var GPSMarkers = [];

        AMapUI.loadUI(['control/BasicControl'], function(BasicControl) {

            //缩放控件，显示Zoom值
            map.addControl(new BasicControl.Zoom({
                position: 'lb',
                showZoomNum: true
            }));

            //图层切换控件
            map.addControl(new BasicControl.LayerSwitcher({
                position: 'rt'
            }));
        });

        AMapUI.loadUI(['misc/PoiPicker'], function(PoiPicker) {

            var poiPicker = new PoiPicker({
                //city:'北京',
                input: 'GPSPickerInput'
            });

            //初始化poiPicker
            poiPickerReady(poiPicker);
        });

        map.on('click', function(e){
            if(GPSMarkers.length > 0) {
                map.remove(GPSMarkers);
            }

            var marker = new AMap.Marker({
                map:map,
                position:[e.lnglat.getLng(), e.lnglat.getLat()],
                label: {
                    offset: new AMap.Pixel(20, 20),//修改label相对于maker的位置
                }
            });

            GPSMarkers.push(marker);

            geocoder.getAddress(e.lnglat.getLng() + "," + e.lnglat.getLat(), function(status, result) {
                if (status === 'complete' && result.regeocode) {
                    var address = result.regeocode.formattedAddress;
                    $("#" + elementId).textbox('setValue', e.lnglat.getLng() + "," + e.lnglat.getLat());
                }else{
                    console.log('根据经纬度查询地址失败');
                }
            });
            //$("#" + elementId).textbox('setValue', e.lnglat.getLng() + "," + e.lnglat.getLat());

            /*setTimeout(function(){
                closeGPSWin();
            }, 3000);*/
        });

        function poiPickerReady(poiPicker) {

            //选取了某个POI
            poiPicker.on('poiPicked', function(poiResult) {
                poi = poiResult.item;
                if(GPSMarkers.length > 0) {
                    map.remove(GPSMarkers);
                }

                var marker = new AMap.Marker();

                marker.setMap(map);

                marker.setPosition(poi.location);
                map.setCenter(marker.getPosition());

                geocoder.getAddress(poi.location.lng + "," + poi.location.lat, function(status, result) {
                    if (status === 'complete' && result.regeocode) {
                        var address = result.regeocode.formattedAddress;
                        $("#" + elementId).textbox('setValue', poi.location.lng + "," + poi.location.lat);
                    }else{
                        console.log('根据经纬度查询地址失败');
                    }
                });

                //$("#" + elementId).textbox('setValue', poi.location.lng + "," + poi.location.lat);

                GPSMarkers.push(marker);

                /*setTimeout(function(){
                    closeGPSWin();
                }, 3000);*/
            });
        }
    }

    /**
     * 公司基地详情
     *
     * @param id
     */
    function showCoolplayBase(id) {
        $('#coolplayBaseDetailWin').window({
            width: "80%",
            height: "80%",
            modal:true
        });

        App.getRequestData('/api/company/coolplayBase/getCoolplayBase', {id: id}, function(data) {
            $(".baseFullNameLabel").text(data.baseFullName);
            $(".baseNameLabel").text(data.baseName);
            $(".baseDescLabel").html(data.baseDesc);
            $(".contactNameLabel").text(data.contactName);
            $(".contactAddressLabel").text(data.contactAddress);
            $(".contactPhoneLabel").text(data.contactPhone);

            $("#detailBackgroudImg").attr("src", data.backgroudImg);

            //渲染基地地图
            var map = new AMap.Map('basePosDetailMap', {
                zoom: 10,
                center:[data.posX,data.posY]
            });

            AMapUI.loadUI(['control/BasicControl', 'overlay/SimpleMarker'], function(BasicControl, SimpleMarker) {

                //缩放控件，显示Zoom值
                map.addControl(new BasicControl.Zoom({
                    position: 'lb',
                    showZoomNum: true
                }));

                //图层切换控件
                map.addControl(new BasicControl.LayerSwitcher({
                    position: 'rt'
                }));

                var marker = new AMap.Marker({
                    map:map,
                    position:[data.posX,data.posY],
                    label: {
                        offset: new AMap.Pixel(20, 20),//修改label相对于maker的位置
                        //content: ""
                    }
                });
            });

            $(".departuresGpsLabel").text(data.departuresGps);
            $(".departuresHeightLabel").text(data.departuresHeight);
            $(".landGpsLabel").text(data.landGps);
            $(".landHeightLabel").text(data.landHeight);
            $(".flyDirectionLabel").text(data.flyDirection);
            $(".monitorVideoUrlLabel").text(data.monitorVideoUrl);
            $(".baseTypeLabel").text(data.baseType);
            $(".labelIdsLabel").text(data.labelName);
            /*$(".openTimeLabel").text(data.openTime);
            $(".capacityCntLabel").text(data.capacityCnt);*/
            var isCloseStr = "正常";
            if(data.isClose == 1) {
                isCloseStr = "关闭";
            }
            $(".isCloseLabel").text(isCloseStr);
        });
    }

    /**
     * 删除公司基地
     *
     * @param id
     */
    function delCoolplayBase(id) {
        App.getRequestData('/api/company/coolplayBase/delCoolplayBase', {id: id, isDel: 1}, function(data){
            App.showMsg('删除公司基地成功!');
            $('#coolplayBaseTab').datagrid('reload');
        });
    }

    /**
     * 关闭公司基地
     *
     * @param id
     */
    function closeCoolplayBase(id, isClose) {
        var isCloseStr = "开放";
        if(isClose == 0) {
            isCloseStr = "关闭";
        }
        App.getRequestData('/api/company/coolplayBase/closeCoolplayBase', {id: id, isClose: isClose}, function(data){
            App.showMsg(isCloseStr + '公司基地成功!');
            $('#coolplayBaseTab').datagrid('reload');
        });
    }

    /**
     * 保存基地信息
     */
    function saveCoolplayBaseWin() {
        var baseDescVal = $("#baseDescEditorDiv").texteditor('getValue');

        $("input[name=baseDesc]").val(baseDescVal);

        if($("#coolplayBaseForm").find("input[name=posX]").val() == '') {
            App.showMsg('请输入基地地图位置!');
            return false;
        }

        //获取可飞风向数据
        if($(".wind_direction_text_active").size() == 0) {
            App.showMsg('请选择可飞风向!');
            return false;
        } else {
            var flyDirections = [];
            $(".wind_direction_text_active").each(function(){
                flyDirections.push($(this).attr('data'));
            });
            $("input[name=flyDirection]").val(flyDirections.join(','));
        }


        $("#coolplayBaseForm").submit();
    }

    /**
     * 关闭新增基地窗口
     */
    function closeCoolplayBaseWin() {
        $('#coolplayBaseWin').window('close');
    }

    /**
     * 关闭基地详情窗口
     */
    function closeCoolplayBaseDetailWin() {
        $("#coolplayBaseDetailWin").window('close');
    }
</script>
</body>
</html>