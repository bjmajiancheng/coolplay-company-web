<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>用户管理</title>
</head>

<body>
<div class="super-theme-example">
    <div class="form-item col-md-4">
        <label for="displayName" class="label-top">账号：</label>
        <input id="displayName" class="easyui-validatebox easyui-textbox" prompt="请输入账号">
    </div>
    <div class="form-item col-md-4">
        <label for="contactPhone" class="label-top">手机号：</label>
        <input id="contactPhone" class="easyui-validatebox easyui-textbox" prompt="请输入手机号">
    </div>

    <div class="form-item col-md-3">
        <a href="javascript:void(0)" onclick="refreshCompanyUser()" class="easyui-linkbutton primary">查询</a>
        <a href="javascript:void(0)" onclick="addCompanyUser()" class="easyui-linkbutton primary">新增账号</a>
    </div>
</div>

<div class="clear"></div>
<div class="super-theme-example">
    <div style="height: 340px;">
        <table id="companyUserTab"></table>
    </div>


    <div id="companyUserWin" class="align_center" style="display: none;padding-top:30px;" title="新增用户">
        <div class="form-item col-md-10">
            <label class="label-top">账户：</label>
            <input class="easyui-validatebox easyui-textbox" prompt="请输入账户">
        </div>
        <div class="form-item col-md-10">
            <label class="label-top">角色：</label>
            <select class="easyui-combobox" data-options="editable:false,panelHeight:null" name="roleId">

            </select>
        </div>
        <div class="form-item col-md-10">
            <label class="label-top">所属部门：</label>
            <select class="easyui-combobox" data-options="editable:false,panelHeight:null" name="deptId">

            </select>
        </div>
        <div class="form-item col-md-10">
            <label class="label-top">联系电话：</label>
            <input class="easyui-validatebox easyui-textbox" prompt="请输入联系电话" name="contactPhone">
        </div>
        <div class="form-item col-md-10">
            <label class="label-top">账号状态：</label>
            <select class="easyui-combobox" data-options="editable:false,panelHeight:null" name="enabled">
                <option value="1" selected>启用</option>
                <option value="0">禁用</option>
            </select>
        </div>
        <div class="form-item col-md-10">
            <a href="javascript:void(0)" class="easyui-linkbutton primary">保存</a>
            <a href="javascript:void(0)" class="easyui-linkbutton primary">取消</a>
        </div>
    </div>
</div>

<script type="text/javascript">
    $('#companyUserTab').datagrid({
        url: App.href + '/api/common/companyUser/list',
        fit: true,
        pagination: true,
        fitColumns: true,
        method: 'GET',
        pageSize: 10,
        pageList: [10, 25, 50, 100, 200],
        height: 340,
        queryParams: {'displayName': $("#displayName").val(), 'contactPhone': $('#contactPhone').val()},
        toolbar: [],
        loadFilter: function(data) {
            if (data.code === 401) {
                App.showMsg('token失效,请登录!');
                window.location.href = App.href + '/login.html';
                return {"total":0, "rows": "[]"};
            } else {
                return data;
            }
        },
        onBeforeLoad: function (param) {
            var displayName = $("#displayName").val();
            var contactPhone = $('#contactPhone').val();

            param.displayName = displayName;
            param.contactPhone = contactPhone;
        },
        columns: [
            [{
                field: 'id',
                title: '编号',
                sortable: true,
                width: 50
            }, {
                field: 'displayName',
                title: '账号',
                width: 50
            }, {
                field: 'contactPhone',
                title: '手机号',
                width: 50
            }, {
                field: 'roleName',
                title: '角色',
                width: 50
            }, {
                field: 'customer_col1',
                title: '用户状态',
                width: 50,
                formatter: function(value, row, index) {
                    if(row.enabled == 1) {
                        return "正常";
                    } else {
                        return "禁用";
                    }
                }
            }, {
                field: 'customer_col2',
                title: '操作',
                width: 50,
                align: 'center',
                formatter: function(value, row, index) {
                    var btns = new Array();
                    btns.push('<a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="updateUserEnabled('+ row.id +', 1);">启用</a>&nbsp;');
                    btns.push('<a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="updateUserEnabled('+ row.id +', 0);">禁用</a>&nbsp;');
                    btns.push('<a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="">查看</a>&nbsp;');
                    btns.push('<a href="javascript:void(0)" class="easyui-linkbutton primary" onclick="">修改</a>');
                    return btns.join('');
                }

            }]
        ]
    });

    function refreshCompanyUser() {
        $('#companyUserTab').datagrid('reload');
    }

    function updateUserEnabled(userId, enabled) {
        var info = "启用";
        if(enabled == 0) {
            info = "禁用";
        }
        $.messager.confirm('确认', '您确认想要'+ info +'用户吗？', function(r) {
            if(r) {
                App.getRequestData('/api/common/companyUser/updateUserEnabled', {'userId': userId, 'enabled': enabled}, function(){
                    App.showMsg(info + '操作成功');
                    refreshCompanyUser();
                });
            }
        });
    }

    /**
     * 添加公司用户
     *
     */
    function addCompanyUser() {
        $('#companyUserWin').window({
            width:600,
            height:400,
            modal:true
        });
    }


</script>
</body>

</html>