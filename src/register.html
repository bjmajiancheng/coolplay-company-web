<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
    <title>企业注册</title>

    <link href="cdn/vendors/jquery-ui/jquery-ui.min.css" rel="stylesheet" media="screen">
    <link href="cdn/vendors/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="cdn/vendors/bootstrap-fileinput/bootstrap-fileinput.css" rel="stylesheet" media="screen">
    <link href="cdn/vendors/jquery-file-upload/css/jquery.fileupload.css" rel="stylesheet" media="screen">
    <link href="cdn/vendors/jquery-file-upload/css/jquery.fileupload-ui.css" rel="stylesheet" media="screen">
    <link href="cdn/vendors/zTree/css/zTreeStyle/zTreeStyle.css" rel="stylesheet">
    <link href="cdn/vendors/jquery-easyui-texteditor/texteditor.css" rel="stylesheet">

    <link rel="stylesheet" href="cdn/vendors/jquery-easyui-1.7.0/themes/gray/easyui.css">
    <!--<link rel="stylesheet" href="cdn/vendors/easyui/themes/gray/easyui.css">-->
    <link rel="stylesheet" href="cdn/super/css/font-awesome.min.css">
    <link rel="stylesheet" href="cdn/super/superBlue.css" id="themeCss">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/register.css"/>
</head>
<body>

<div class="banner">
    <span>企业注册信息</span>
</div>
<div class="content">
    <form id="registerForm" method="post">
        <ul>
            <li>
                <span>显示名称/隐藏名称</span>
                <input type="text" name="companyFullName" />
            </li>
            <li>
                <span>公司简称</span>
                <input type="text" name="companyName" />
            </li>
            <li>
                <span>所属行业</span>
                <dl class="fuXuan">
                </dl>
            </li>
            <li>
                <span>公司简介</span>
                <textarea name="companyDesc" rows="" cols=""></textarea>
            </li>
            <li>
                <span>公司地址</span>
                <input type="text" name="contactAddress" />
            </li>
            <li>
                <span>主营项目</span>
                <div class="zdy">
                    <button type="button" onclick="OpenAlert()"><img src="cdn/img/jiaHao.png"/></button>

                </div>
                <div style="width: 100%;height: 1px;clear: both;"></div>
                <!--<select name="majorProject">
                    <option value="">请选择</option>
                </select>-->
            </li>
            <li>
                <span>营业执照附件</span>
                <div class="imageList">
                    <dl id="imageListOne">
                        <dd>
                            <button type="button" class="btnOne" onclick="document.getElementById('fileOne').click()">
                                <img src="cdn/img/jiaHao.png"/>
                            </button>
                        </dd>
                    </dl>
                    <input type="file" id="fileOne" name="file" style="display: none;" />
                </div>
                <div style="width: 100%;height: 1px;clear: both;"></div>
            </li>
            <li>
                <span>法人姓名</span>
                <input type="text" name="legalName" />
            </li>
            <li>
                <span>法人身份证号</span>
                <input type="text" name="legalIdcard" />
            </li>
            <li>
                <span>身份证正反面</span>
                <div class="imageList">
                    <dl id="imageListTwe">
                        <dd>
                            <button type="button" class="btnTwe" onclick="document.getElementById('fileTwe').click()">
                                <img src="cdn/img/jiaHao.png"/>
                            </button>
                        </dd>
                    </dl>
                </div>
                <input type="file" id="fileTwe" name="file" style="display: none;" />
                <div style="width: 100%;height: 1px;clear: both;"></div>
            </li>
            <li>
                <span>联系人</span>
                <input type="text" name="contactName" />
            </li>
            <li>
                <span>电 话</span>
                <input type="text" name="contactMobile" />
            </li>
            <li>
                <span>邮 箱</span>
                <input type="text" name="companyEmail" />
            </li>
            <li class="btn">
                <input type="button" onclick="register()" value="注册"/>
            </li>
        </ul>
    </form>
</div>

<div class="inputAlert">
    <p>请输入主营项目</p>
    <div class="AlertContent">
        <input type="text" class="zdyString" />
    </div>
    <p class="btnP">
        <button type="button" onclick="addSpan()">添加</button>
        <button type="button" onclick="ClertAlert()">取消</button>
    </p>
</div>

</body>
<script src="cdn/vendors/jquery-easyui-1.7.0/jquery.min.js" type="text/javascript" charset="utf-8"></script>
<script src="cdn/vendors/jquery-ui/jquery-ui.min.js"></script>
<script src="cdn/vendors/jquery.validate.min.js"></script>
<script src="cdn/vendors/localization/messages_zh.js"></script>

<script src="cdn/vendors/bootstrap/js/bootstrap.js"></script>
<script src="cdn/vendors/bootbox.js"></script>
<script src="cdn/vendors/jquery.tmpl.min.js"></script>
<script src="cdn/vendors/ajaxfileupload.js"></script>
<script src="cdn/vendors/jquery.cookie/jquery.cookie.js"></script>
<script src="cdn/vendors/bootstrap-fileinput/bootstrap-fileinput.js"></script>
<script src="cdn/vendors/jquery-file-upload/js/jquery.fileupload.js"></script>
<script src="cdn/vendors/jquery-file-upload/js/jquery.fileupload-jquery-ui.js"></script>
<script src="cdn/vendors/zTree/js/jquery.ztree.core-3.5.min.js"></script>
<script src="cdn/vendors/zTree/js/jquery.ztree.excheck-3.5.min.js"></script>
<script src="cdn/vendors/zTree/js/jquery.ztree.exedit-3.5.min.js"></script>

<!--<script src="cdn/vendors/easyui/jquery.easyui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="cdn/vendors/easyui/locale/easyui-lang-zh_CN.js" type="text/javascript" charset="utf-8"></script>-->

<script src="cdn/vendors/jquery-easyui-1.7.0/jquery.easyui.min.js" type="text/javascript" charset="utf-8"></script>
<script src="cdn/vendors/jquery-easyui-1.7.0/locale/easyui-lang-zh_CN.js" type="text/javascript" charset="utf-8"></script>

<script src="cdn/vendors/jquery-easyui-texteditor/jquery.texteditor.js"></script>
<script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=I9koTHOWtxzVXA60W8SyGDkObzLlrYFM"></script>

<script src="cdn/super/super.js"></script>
<script src="cdn/super/superDemo.js" type="text/javascript" charset="utf-8"></script>

<script src="js/app.js" type="text/javascript" charset="utf-8"></script>
<script src="js/common.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
    Array.prototype.indexOf = function(val) {
        for (var i = 0; i < this.length; i++) {
            if (this[i] == val) return i;
        }
        return -1;
    };
    Array.prototype.remove = function(val) {
        var index = this.indexOf(val);
        if (index > -1) {
            this.splice(index, 1);
        }
    };
    var arrOne = []; // 营业执照附件
    var arrTwe = []; // 身份证正反面
    var arrOneUrlArr = []; //营业执照附件链接
    var arrTweUrlArr = []; //身份证正反面链接

    /**
     * 更新事件
     */
    function uploadListener() {
        $('#fileOne').change(function(){   // 营业执照附件监听
            uploadImage("fileOne", function(data){
                arrOneUrlArr.push(data.attachmentUrl);
                console.log(data.attachmentUrl);

                $('#imageListOne').prepend('<dd><img src = "'+data.attachmentUrl+'"/><b imgname="'+data.attachmentUrl+'" imgurl="'+ data.attachmentUrl +'" onclick="deleteImage(this,1)">x</b></dd>');
                $("#fileOne").replaceWith('<input type="file" id="fileOne" name="file" style="display: none;" />');

                uploadListener();
            });
        });
    }

    function uploadFileTweListener() {
        $('#fileTwe').change(function(){   // 身份证正反面监听

            /** 身份证正反面附件上传 */
            uploadImage("fileTwe", function(data){
                arrTweUrlArr.push(data.attachmentUrl);
                console.log(data.attachmentUrl);

                $('#imageListTwe').prepend('<dd><img src = "'+data.attachmentUrl+'"/><b imgname = "'+data.attachmentUrl+'" imgurl="'+ data.attachmentUrl +'" onclick="deleteImage(this,2)">x</b>>x</b></dd>');
                $("#fileTwe").replaceWith('<input type="file" id="fileTwe" name="file" style="display: none;" />');

                uploadFileTweListener();
            });
        });
    }

    // 图片删除
    function deleteImage(a,b){
        var imgname = $(a).attr('imgname');
        var imgurl = $(a).attr('imgurl');
        var deleteArr = '';
        if (b == 1) {
            for (var i = 0;i<arrOne.length;i++) {
                if (arrOne[i].name == imgname) {
                    deleteArr = arrOne[i];
                }
            }
            arrOne.remove(deleteArr);

            for (var i = 0;i<arrOneUrlArr.length;i++) {
                if (arrOneUrlArr[i] == imgname) {
                    deleteArr = arrOneUrlArr[i];
                }
            }
            arrOneUrlArr.remove(deleteArr);
        } else{
            for (var i = 0;i<arrTwe.length;i++) {
                if (arrTwe[i].name == imgname) {
                    deleteArr = arrTwe[i];
                }
            }
            arrTwe.remove(deleteArr);

            for (var i = 0;i<arrTweUrlArr.length;i++) {
                if (arrTweUrlArr[i] == imgname) {
                    deleteArr = arrTweUrlArr[i];
                }
            }
            arrTweUrlArr.remove(deleteArr);
        }

        $(a).parent().remove();
    }

    // 获取行业
    function getInd(){
        var ddList = $('.fuXuan .xz');
        var valList = [];
        for(var i = 0;i<ddList.length; i++){
            valList.push($(ddList[i]).attr('val'));
        }
        return valList;
    }

    function OpenAlert(){
        $('.inputAlert').show();
    }

    function ClertAlert(){
        $('.inputAlert').hide();
    }

    function addSpan(){
        var cc = $('.zdyString').val();
        var aa = '';
        if (cc.length <8) {
            aa = cc;
        } else{
            aa = cc.substring(0,8) + '...';
        }
        $('.zdy').prepend('<span title="'+cc+'">'+aa+'<b onclick="removeSpan(this)">x</b></span>');
        $('.zdyString').val('');
        $('.inputAlert').hide();
    }

    function removeSpan(a){
        $(a).parent().remove();
    }

    function getzdy(){    //  获取自定标签
        var cc = $('.zdy span');
        var textArr = [];
        for (var i=0;i<cc.length;i++) {
            textArr.push($(cc[i]).attr('title').substring(0,$(cc[i]).attr('title').length));
        }
        return textArr;
    }

    /**
     * 上传图片
     *
     * @param fileInputId   文件ID
     * @param callback      返回方法
     */
    function uploadImage(fileInputId, callback) {
        $.ajaxFileUpload({
            url: App.href + "/api/common/uploadImage",
            type: "POST",
            fileElementId: fileInputId,
            dataType: "json",
            success: function (json, status) {
                if (json.code === 200) {
                    callback(json.data);
                } else {
                    alert(json.message);
                    return;
                }
            },
            error: function (data, status, e) {
                alert(e);
            }
        });
    }

    ;(function ($, window, document, undefined){
        //获取行业选项信息
        App.getRequestData('/api/noneAuth/industryOptions', {}, function(result) {
            for(var i = 0; i < result.length; i++) {
                $(".fuXuan").append($('<dd val = "'+ result[i]['value'] +'">'+ result[i]['text'] +'</dd>'));
            }

            $('.fuXuan>dd').click(function(){
                var thisClass = $(this).attr('class');
                if (thisClass == 'xz') {
                    $(this).removeClass("xz")
                } else{
                    $(this).attr("class","xz")
                }
            });
        });

        //验证表单信息
        $("#registerForm").validate({
            errorElement: 'p',
            errorClass: 'falseP',
            submitHandler: function(form) {
                $('#registerForm').form({
                    url: App.href + '/api/token/register',
                    method: 'POST',
                    onSubmit:function(){
                        return $(this).form('validate');
                    },
                    success:function(data){
                        var obj = JSON.parse(data);
                        if (obj.code == 200) {
                            App.showMsg('注册成功，平台审核通过后短信通知您登录方式...');
                        } else {
                            App.showMsg(obj.message);
                        }
                    }
                });
            },
            rules:{
                companyFullName:{
                    required:true
                },
                companyName:{
                    required:true
                },
                companyDesc:{
                    required:true
                },
                contactAddress:{
                    required:true
                },
                legalName:{
                    required:true
                },
                legalIdcard:{
                    required:true,
                    idcard:true
                },
                contactName:{
                    required:true
                },
                contactMobile: {
                    required: true,
                    isMobile: true
                },
                companyEmail :{
                    required: true,
                    email:true
                }
            },
            messages:{
                companyFullName:{
                    required:'请输入一个名称'
                },
                companyName:{
                    required:'请输入一个公司简称'
                },
                companyDesc:{
                    required:'请输入一个公司简介'
                },
                contactAddress:{
                    required:'请输入一个公司公司地址'
                },
                legalName:{
                    required:'请输入法人姓名'
                },
                legalIdcard:{
                    required:'请输入法人身份证号'
                },
                contactName:{
                    required:'请输入联系人'
                },
                contactMobile: {
                    required: '请输入您的常用手机号码'
                },
                companyEmail :{
                    required: '请输入您的邮箱',
                    email:'邮箱格式不正确'
                }
            },
            onsubmit:true
        });

        uploadListener();
        uploadFileTweListener();
    })(jQuery, window, document);

    // 注册
    function register() {
        var industryList = getInd();
        if(industryList.length == 0) {
            alert("请选择所属行业...");

            return false;
        }

        var majorProjectList = getzdy();
        if(majorProjectList.length == 0) {
            alert("请选择主营项目...");

            return false;
        }

        if(arrOneUrlArr.length == 0) {
            alert("请上传营业执照附件...");

            return false;
        } else {
            console.log(arrOneUrlArr);
        }

        if(arrTweUrlArr.length == 0) {
            alert("请上传身份证正反面...");

            return false;
        } else {
            console.log(arrTweUrlArr);
        }


        $("#registerForm").submit();
    }
</script>
</html>